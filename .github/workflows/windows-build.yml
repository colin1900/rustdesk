- name: Set up VCPKG
        run: |
          # 1. 克隆 vcpkg
          git clone https://github.com/microsoft/vcpkg.git
          .\vcpkg\bootstrap-vcpkg.bat
          
          # 2. 设置环境变量（非常重要，Rust 编译时需要根据这个找库）
          echo "VCPKG_ROOT=$((Get-Item .).FullName)\vcpkg" >> $env:GITHUB_ENV
          $vcpkg_path = "$((Get-Item .).FullName)\vcpkg"
          
          # 3. 执行安装（不带参数，直接读取项目自带的 vcpkg.json）
          # 使用 --triplet 指定 Windows 64 位静态编译
          .\vcpkg\vcpkg install --triplet x64-windows-static-md
          
      - name: Build Windows App
        run: |
          # 确保 Rust 编译器能找到 vcpkg 编译出来的库
          $env:VCPKG_ROOT = "$((Get-Item .).FullName)\vcpkg"
          
          # 启用 Flutter Windows 支持
          flutter config --enable-windows-desktop
          
          # 执行编译
          flutter build windows --release

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: RustDesk-Windows-Exe
          # 注意：RustDesk 编译后的产物通常在以下路径，请确认
          path: build/windows/runner/Release/
